# Hello Strands Agent with Google Spreadsheets and Slack

## ğŸ“– ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã¤ã„ã¦

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€**AI ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒ Google Spreadsheets ã‚„ Slack ã‚’è‡ªå‹•æ“ä½œã§ãã‚‹**ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚

è‡ªç„¶è¨€èªã§ã€Œãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ Google Sheets ã«è¿½åŠ ã—ã¦ã€ã€ŒSlack ã«é€šçŸ¥ã—ã¦ã€ã¨æŒ‡ç¤ºã™ã‚‹ã¨ã€AI ãŒè‡ªå‹•çš„ã«æ“ä½œã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

### ğŸ’¡ ãªãœã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã£ãŸã®ã‹ï¼Ÿ

**å¾“æ¥ã®èª²é¡Œ:**
- Slack ã‚„ Google Sheets ã®æ“ä½œã«ã¯ã€ãã‚Œãã‚Œã® API ã‚’ç†è§£ã—ã€ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãå¿…è¦ãŒã‚ã‚Šã¾ã—ãŸ
- è¤‡æ•°ã®ãƒ„ãƒ¼ãƒ«ã‚’é€£æºã•ã›ã‚‹ã«ã¯ã€è¤‡é›‘ãªçµ±åˆå‡¦ç†ãŒå¿…è¦ã§ã—ãŸ

**ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§å®Ÿç¾ã§ãã‚‹ã“ã¨:**
- **è‡ªç„¶è¨€èªã§ã®æ“ä½œ**: ã€Œãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿½åŠ ã—ã¦ã€ã¨è¨€ã†ã ã‘ã§ AI ãŒé©åˆ‡ãªãƒ„ãƒ¼ãƒ«ã‚’é¸æŠ
- **è¤‡æ•°ãƒ„ãƒ¼ãƒ«ã®è‡ªå‹•é€£æº**: AI ãŒ Google Sheets ã¨ Slack ã‚’çµ„ã¿åˆã‚ã›ã¦ä½¿ç”¨
- **æ‹¡å¼µæ€§**: æ–°ã—ã„ãƒ„ãƒ¼ãƒ«ã‚’è¿½åŠ ã™ã‚‹ã ã‘ã§ã€AI ãŒè‡ªå‹•çš„ã«ä½¿ã„æ–¹ã‚’å­¦ç¿’

### ğŸ¯ æƒ³å®šã•ã‚Œã‚‹åˆ©ç”¨ã‚·ãƒ¼ãƒ³

- **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ã®è‡ªå‹•åŒ–**: ã€Œæ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ Sheets ã«è¿½åŠ ã—ã¦ã€ãƒãƒ¼ãƒ ã« Slack é€šçŸ¥ã€
- **ãƒ¬ãƒãƒ¼ãƒˆä½œæˆ**: ã€Œä»Šæ—¥ã®ã‚¿ã‚¹ã‚¯ã‚’ Sheets ã‹ã‚‰å–å¾—ã—ã¦ã€ã‚µãƒãƒªãƒ¼ã‚’ Slack ã«æŠ•ç¨¿ã€
- **é€šçŸ¥ã®è‡ªå‹•åŒ–**: ã€Œé‡è¦ãªå¤‰æ›´ãŒã‚ã£ãŸã‚‰ Slack ã«é€šçŸ¥ã€

---

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ  â”‚  â† HTTP POST ã§ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆé€ä¿¡
â”‚  (curl/App) â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   API Gateway       â”‚  â† HTTP ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆæä¾›
â”‚  (AWS)              â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Lambda Function (Docker)       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Strands Agent            â”‚  â”‚  â† AI ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
â”‚  â”‚  - add_project ãƒ„ãƒ¼ãƒ«     â”‚  â”‚
â”‚  â”‚  - notify_slack ãƒ„ãƒ¼ãƒ«    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚          â”‚                      â”‚
â”‚          â–¼                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  AWS Bedrock  â”‚              â”‚  â† Claude Sonnet 4.5
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚              â”‚
          â–¼              â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚Google Sheets â”‚  â”‚  Slack   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ ä½¿ç”¨æŠ€è¡“ã¨ãã®é¸å®šç†ç”±

### ãªãœ Strands Agent ãªã®ã‹ï¼Ÿ

**Strands** ã¯ã€AI ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ãƒ„ãƒ¼ãƒ«ã‚’ç°¡å˜ã«æ¸¡ã›ã‚‹ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã™ã€‚

- **âœ… åˆ©ç‚¹**: Python é–¢æ•°ã‚’ `@tool` ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ã§è£…é£¾ã™ã‚‹ã ã‘ã§ãƒ„ãƒ¼ãƒ«ã«ãªã‚‹
- **âœ… AI ãŒè‡ªå‹•åˆ¤æ–­**: ã©ã®ãƒ„ãƒ¼ãƒ«ã‚’ã„ã¤ä½¿ã†ã‹ AI ãŒæ±ºå®š
- **âœ… ã‚·ãƒ³ãƒ—ãƒ«**: ã‚³ãƒ¼ãƒ‰é‡ãŒå°‘ãªãã€åˆå­¦è€…ã§ã‚‚ç†è§£ã—ã‚„ã™ã„

### ãªãœ AWS Lambda (Docker) ãªã®ã‹ï¼Ÿ

**ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚

- **âœ… ã‚³ã‚¹ãƒˆå‰Šæ¸›**: ä½¿ã£ãŸåˆ†ã ã‘èª²é‡‘ï¼ˆã‚¢ã‚¤ãƒ‰ãƒ«æ™‚ã¯ç„¡æ–™ï¼‰
- **âœ… ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£**: è‡ªå‹•ã§ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆ
- **âœ… é‹ç”¨ä¸è¦**: ã‚µãƒ¼ãƒãƒ¼ç®¡ç†ãŒä¸è¦
- **âœ… Docker ã‚³ãƒ³ãƒ†ãƒŠ**: ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å«ã‚ã¦ãƒ‡ãƒ—ãƒ­ã‚¤å¯èƒ½

### ãªãœ AWS Bedrock ãªã®ã‹ï¼Ÿ

**AWS Bedrock** ã¯ã€Claude ãªã©ã® AI ãƒ¢ãƒ‡ãƒ«ã‚’ API çµŒç”±ã§åˆ©ç”¨ã§ãã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚

- **âœ… API ã‚­ãƒ¼ä¸è¦**: AWS ã®æ¨©é™ç®¡ç†ã§å®‰å…¨
- **âœ… é«˜é€Ÿ**: AWS å†…éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã§ä½ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·
- **âœ… ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºå¯¾å¿œ**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹æº–æ‹ 

### ãªãœ Terraform ãªã®ã‹ï¼Ÿ

**Infrastructure as Code (IaC)** ã‚’å®Ÿç¾ã—ã¾ã™ã€‚

- **âœ… å†ç¾æ€§**: åŒã˜æ§‹æˆã‚’ä½•åº¦ã§ã‚‚å†ç¾å¯èƒ½
- **âœ… ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†**: ã‚¤ãƒ³ãƒ•ãƒ©ã®å¤‰æ›´å±¥æ­´ã‚’ Git ã§ç®¡ç†
- **âœ… ãƒãƒ¼ãƒ é–‹ç™º**: è¤‡æ•°äººã§ã‚¤ãƒ³ãƒ•ãƒ©ã‚’å…±åŒç®¡ç†
- **âœ… å®£è¨€çš„**: ã€Œä½•ã‚’ä½œã‚‹ã‹ã€ã‚’è¨˜è¿°ï¼ˆæ‰‹é †ã§ã¯ãªãï¼‰

### ãªãœ S3 Backend ãªã®ã‹ï¼Ÿ

Terraform ã®**çŠ¶æ…‹ãƒ•ã‚¡ã‚¤ãƒ« (tfstate)** ã‚’ S3 ã«ä¿å­˜ã—ã¾ã™ã€‚

- **âœ… ãƒãƒ¼ãƒ å…±æœ‰**: è¤‡æ•°äººã§åŒã˜çŠ¶æ…‹ã‚’å‚ç…§
- **âœ… ãƒ­ãƒƒã‚¯æ©Ÿèƒ½**: åŒæ™‚å®Ÿè¡Œã‚’é˜²æ­¢
- **âœ… æ°¸ç¶šåŒ–**: ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã®ç´›å¤±ã‚’é˜²æ­¢
- **âœ… ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†**: çŠ¶æ…‹ã®å±¥æ­´ã‚’ä¿æŒ

---

## ğŸ“‹ å‰ææ¡ä»¶

### 1. mise ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

**ãªãœå¿…è¦ï¼Ÿ**
- Terraformã€AWS CLIã€Pythonã€uv ãªã©ã®é–‹ç™ºãƒ„ãƒ¼ãƒ«ã‚’**ä¸€æ‹¬ç®¡ç†**ã§ãã‚‹
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã”ã¨ã«ç•°ãªã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’è‡ªå‹•ã§åˆ‡ã‚Šæ›¿ãˆ
- `.mise.toml` ã«å®šç¾©ã•ã‚ŒãŸãƒ„ãƒ¼ãƒ«ã‚’ `mise install` ã ã‘ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

**mise ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•**

```bash
# macOS
curl https://mise.run | sh

# ã¾ãŸã¯ Homebrew
brew install mise

# ã‚·ã‚§ãƒ«ã®è¨­å®šï¼ˆnushell ã®å ´åˆï¼‰
echo 'mise activate nu | save --append ~/.config/nushell/config.nu' | nu
```

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ„ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**

```bash
cd helloStrandsAgentWithGoogleSpreadsheetsAndSlack
mise install
```

ã“ã‚Œã§ä»¥ä¸‹ã®ãƒ„ãƒ¼ãƒ«ãŒè‡ªå‹•çš„ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã™ï¼š
- Python 3.14
- uv 0.9.20
- Terraform 1.14.3
- AWS CLI 2.32.25

**å‚è€ƒãƒªãƒ³ã‚¯:**
- [mise å…¬å¼ã‚µã‚¤ãƒˆ](https://mise.jdx.dev/)

> **ğŸ’¡ mise ã®åˆ©ç‚¹**
> - è¤‡æ•°ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé–“ã§ãƒ„ãƒ¼ãƒ«ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç«¶åˆã‚’å›é¿
> - `.mise.toml` ã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä¸€å…ƒç®¡ç†
> - ãƒãƒ¼ãƒ å…¨ä½“ã§åŒã˜ç’°å¢ƒã‚’å†ç¾å¯èƒ½

### 2. Orbstack ã¾ãŸã¯ Docker Desktop

**ãªãœå¿…è¦ï¼Ÿ**
- Lambda é–¢æ•°ã‚’ **Docker ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸** ã¨ã—ã¦ãƒ“ãƒ«ãƒ‰ã™ã‚‹ãŸã‚
- Terraform ãŒ `docker build` ã¨ `docker push` ã‚’å®Ÿè¡Œ

**Orbstack ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³• (macOS)**

```bash
brew install orbstack
```

> **ğŸ’¡ Orbstack vs Docker Desktop**
> - Orbstack: è»½é‡ãƒ»é«˜é€Ÿã€macOS å°‚ç”¨
> - Docker Desktop: ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã€æ©Ÿèƒ½è±Šå¯Œ

**å‚è€ƒãƒªãƒ³ã‚¯:**
- [Orbstack å…¬å¼ã‚µã‚¤ãƒˆ](https://orbstack.dev/download)
- [Docker Desktop å…¬å¼ã‚µã‚¤ãƒˆ](https://www.docker.com/products/docker-desktop)

### 3. AWS ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ

**ãªãœå¿…è¦ï¼Ÿ**
- Lambdaã€API Gatewayã€Bedrock ãªã©ã® AWS ã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ©ç”¨

**å¿…è¦ãªæ¨©é™:**
- IAMã€Lambdaã€ECRã€API Gatewayã€S3ã€Bedrock ã¸ã®ãƒ•ãƒ«ã‚¢ã‚¯ã‚»ã‚¹

### 4. AWS CLI ã®è¨­å®š

**ãªãœå¿…è¦ï¼Ÿ**
- Terraform ãŒ AWS API ã‚’å‘¼ã³å‡ºã™ãŸã‚
- Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ ECR ã«ãƒ—ãƒƒã‚·ãƒ¥ã™ã‚‹ãŸã‚

> **ğŸ’¡ AWS CLI ã¯ mise ã§æ—¢ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿**
> - `mise install` ã§ AWS CLI 2.32.25 ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã¾ã™
> - ã“ã“ã§ã¯èªè¨¼æƒ…å ±ã®è¨­å®šã®ã¿è¡Œã„ã¾ã™

#### AWS SSO ã‚’ä½¿ç”¨ã—ãŸèªè¨¼

**åˆå›è¨­å®šï¼ˆSSO æœªè¨­å®šã®å ´åˆï¼‰:**

```bash
aws configure sso
```

**è¨­å®šé …ç›®:**
- SSO start URL: çµ„ç¹”ã® AWS SSO ãƒãƒ¼ã‚¿ãƒ« URL
- SSO Region: SSO ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ãƒªãƒ¼ã‚¸ãƒ§ãƒ³
- Default region name: `ap-northeast-1`ï¼ˆæ±äº¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ï¼‰
- Default output format: `json`
- CLI profile name: ä»»æ„ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«åï¼ˆä¾‹: `default` ã¾ãŸã¯ `your-org`ï¼‰

**ãƒ­ã‚°ã‚¤ãƒ³:**

```bash
aws sso login
```

> **ğŸ’¡ AWS SSO ã®ãƒ¡ãƒªãƒƒãƒˆ**
> - ä¸€æ™‚çš„ãªèªè¨¼æƒ…å ±ã§ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å‘ä¸Š
> - ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ã®ç®¡ç†ãŒä¸è¦
> - è¤‡æ•°ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¸ã®åˆ‡ã‚Šæ›¿ãˆãŒå®¹æ˜“
> - MFAï¼ˆå¤šè¦ç´ èªè¨¼ï¼‰ã¨ã®çµ±åˆ

### 5. èªè¨¼æƒ…å ±ã®æº–å‚™

**ãªãœå¿…è¦ï¼Ÿ**
- Lambda é–¢æ•°ãŒå®Ÿè¡Œæ™‚ã« Google Sheets ã‚„ Slack ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®èªè¨¼æƒ…å ±ãŒå¿…è¦
- ã“ã‚Œã‚‰ã®èªè¨¼æƒ…å ±ã¯å¾Œã®ã‚¹ãƒ†ãƒƒãƒ—ã§ Parameter Store ã«æš—å·åŒ–ã—ã¦ä¿å­˜ã—ã¾ã™

**æº–å‚™ã™ã‚‹èªè¨¼æƒ…å ±:**
1. Google ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆèªè¨¼æƒ…å ±ï¼ˆJSON ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
2. Slack Bot Token
3. Spreadsheet ID

#### 5-1. Google ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆèªè¨¼æƒ…å ±ã®æº–å‚™

**Google Cloud Console ã§ ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆ:**

1. [Google Cloud Console](https://console.cloud.google.com/) ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠï¼ˆã¾ãŸã¯æ–°è¦ä½œæˆï¼‰
3. ã€ŒIAM ã¨ç®¡ç†ã€â†’ã€Œã‚µãƒ¼ãƒ“ã‚¹ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã€â†’ã€Œã‚µãƒ¼ãƒ“ã‚¹ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã€
4. ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåã‚’å…¥åŠ›ï¼ˆä¾‹: `sheets-slack-agent`ï¼‰
5. ã€Œã‚­ãƒ¼ã‚’ä½œæˆã€â†’ã€ŒJSONã€ã‚’é¸æŠã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
6. ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸ JSON ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ `credentials/service-account-key.json` ã«é…ç½®

**Google Sheets API ã‚’æœ‰åŠ¹åŒ–:**

1. [Google Cloud Console](https://console.cloud.google.com/) â†’ ã€ŒAPI ã¨ã‚µãƒ¼ãƒ“ã‚¹ã€
2. ã€Œãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€â†’ã€ŒGoogle Sheets APIã€ã‚’æ¤œç´¢
3. ã€Œæœ‰åŠ¹ã«ã™ã‚‹ã€ã‚’ã‚¯ãƒªãƒƒã‚¯

**ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©ã‚’ä»˜ä¸:**

1. ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’é–‹ã
2. ã€Œå…±æœ‰ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆ`xxx@xxx.iam.gserviceaccount.com`ï¼‰ã‚’è¿½åŠ 
4. ã€Œç·¨é›†è€…ã€æ¨©é™ã‚’ä»˜ä¸

#### 5-2. Slack Bot Token ã®å–å¾—

1. [Slack API](https://api.slack.com/apps) ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ã€ŒCreate New Appã€â†’ã€ŒFrom scratchã€
3. ã‚¢ãƒ—ãƒªåã¨ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã‚’é¸æŠ
4. ã€ŒOAuth & Permissionsã€â†’ã€ŒScopesã€ã§ä»¥ä¸‹ã‚’è¿½åŠ ï¼š
   - `chat:write`
   - `chat:write.public`
5. ã€ŒInstall to Workspaceã€ã‚’ã‚¯ãƒªãƒƒã‚¯
6. è¡¨ç¤ºã•ã‚Œã‚‹ã€ŒBot User OAuth Tokenã€ï¼ˆ`xoxb-` ã§å§‹ã¾ã‚‹ï¼‰ã‚’ã‚³ãƒ”ãƒ¼

#### 5-3. Spreadsheet ID ã®ç¢ºèª

ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã® URL ã‹ã‚‰å–å¾—ã—ã¾ã™ï¼š

```
https://docs.google.com/spreadsheets/d/SPREADSHEET_ID/edit
                                      ^^^^^^^^^^^^^^
                                      ã“ã®éƒ¨åˆ†ãŒ ID
```

---

## ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆã‚¬ã‚¤ãƒ‰

### 1. ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³

```bash
git clone https://github.com/miyatam3551/helloStrandsAgentWithGoogleSpreadsheetsAndSlack.git
cd helloStrandsAgentWithGoogleSpreadsheetsAndSlack
```

### 2. é–‹ç™ºãƒ„ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
mise install
```

**ã“ã®ã‚³ãƒãƒ³ãƒ‰ã§ä½•ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã‚‹ã‹ï¼Ÿ**
- Python 3.14
- uv 0.9.20ï¼ˆPython ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ï¼‰
- Terraform 1.14.3ï¼ˆã‚¤ãƒ³ãƒ•ãƒ©æ§‹ç¯‰ãƒ„ãƒ¼ãƒ«ï¼‰
- AWS CLI 2.32.25ï¼ˆAWS æ“ä½œãƒ„ãƒ¼ãƒ«ï¼‰

**ç¢ºèªæ–¹æ³•:**
```bash
mise list
```

**å‡ºåŠ›ä¾‹:**
```
python   3.14      ~/.local/share/mise/installs/python/3.14
uv       0.9.20    ~/.local/share/mise/installs/uv/0.9.20
terraform 1.14.3   ~/.local/share/mise/installs/terraform/1.14.3
aws      2.32.25   ~/.local/share/mise/installs/aws/2.32.25
```

### 3. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

#### 3-1. .env ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚³ãƒ”ãƒ¼

```bash
cp .env.example .env
```

**ãªãœã“ã®ã‚¹ãƒ†ãƒƒãƒ—ãŒå¿…è¦ï¼Ÿ**
- `.env.example` ãƒ•ã‚¡ã‚¤ãƒ«ã¯**ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ**ï¼ˆGit ã«ã‚³ãƒŸãƒƒãƒˆï¼‰
- å®Ÿéš›ã® `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯**æ©Ÿå¯†æƒ…å ±**ï¼ˆParameter Store ã®ãƒ‘ã‚¹åãªã©ï¼‰ã‚’å«ã‚€ãŸã‚ `.gitignore` ã§é™¤å¤–
- ã“ã‚Œã«ã‚ˆã‚Šã€æ©Ÿå¯†æƒ…å ±ã‚’èª¤ã£ã¦å…¬é–‹ã™ã‚‹ãƒªã‚¹ã‚¯ã‚’å›é¿

#### 3-2. .env ã®ç·¨é›†

```bash
vim .env
```

ä»¥ä¸‹ã®å€¤ã‚’**ã‚ãªãŸã®ç’°å¢ƒã«åˆã‚ã›ã¦**è¨­å®šã—ã¾ã™ï¼š

```bash
# ============================================
# Terraform å¤‰æ•°
# ============================================
# TF_VAR_ ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã«ã‚ˆã‚Š Terraform ãŒè‡ªå‹•èªè­˜ã—ã¾ã™
# ã“ã‚Œã‚‰ã®å€¤ã¯ Lambda ã®ç’°å¢ƒå¤‰æ•°ã¨ã—ã¦è‡ªå‹•è¨­å®šã•ã‚Œã¾ã™

# AWS ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ IDï¼ˆaws sts get-caller-identity --query Account --output text ã§å–å¾—ï¼‰
TF_VAR_aws_account_id="123456789012"

# Parameter Store ã®ãƒ‘ã‚¹å
# Lambda å®Ÿè¡Œæ™‚ã« Parameter Store ã‹ã‚‰ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’å–å¾—ã™ã‚‹éš›ã®ãƒ‘ã‚¹ã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã¾ã™
TF_VAR_param_spreadsheet_id="/your-prefix/spreadsheet-id"
TF_VAR_param_google_credentials="/your-prefix/google-credentials"
TF_VAR_param_slack_bot_token="/your-prefix/slack-bot-token"
```

**è¨­å®šé …ç›®ã®èª¬æ˜:**
- `TF_VAR_aws_account_id`: ã‚ãªãŸã® AWS ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ IDï¼ˆ[ç¢ºèªæ–¹æ³•](#aws-account-id-ã®ç¢ºèªæ–¹æ³•)ï¼‰
- `TF_VAR_param_*`: Parameter Store ã®ãƒ‘ã‚¹åï¼ˆLambda å®Ÿè¡Œæ™‚ã«ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’å–å¾—ã™ã‚‹éš›ã«ä½¿ç”¨ï¼‰
- ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ï¼ˆä¾‹: `/your-prefix/`ï¼‰ã¯æ¨æ¸¬ã•ã‚Œã«ãã„ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å›ºæœ‰ã®åå‰ã‚’ä½¿ç”¨

**AWS Account ID ã®ç¢ºèªæ–¹æ³•:**
```bash
aws sts get-caller-identity --query Account --output text
```

> **ğŸ’¡ .env ãƒ•ã‚¡ã‚¤ãƒ«ä¸€å…ƒç®¡ç†ã®åˆ©ç‚¹**
> - ã™ã¹ã¦ã®è¨­å®šã‚’ `.env` ãƒ•ã‚¡ã‚¤ãƒ«ä¸€ã¤ã§ç®¡ç†ï¼ˆ`terraform.tfvars` ã¯ä¸è¦ï¼‰
> - `TF_VAR_` ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã«ã‚ˆã‚Š Terraform ãŒè‡ªå‹•èªè­˜
> - Parameter Store ã®ãƒ‘ã‚¹åã‚’ä¸€ç®‡æ‰€ã§ç®¡ç†ã—ã€åŒæœŸãƒŸã‚¹ã‚’é˜²æ­¢
> - æ©Ÿå¯†æƒ…å ±ã‚’ `.gitignore` ã§ä¿è­·

### 4. Parameter Store ã¸ã®èªè¨¼æƒ…å ±ã®ç™»éŒ²

**ãªãœã“ã®ã‚¹ãƒ†ãƒƒãƒ—ãŒå¿…è¦ï¼Ÿ**
- Lambda é–¢æ•°ãŒå®Ÿè¡Œæ™‚ã« Google Sheets ã‚„ Slack ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã«ã¯ã€èªè¨¼æƒ…å ±ãŒå¿…è¦
- `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã§è¨­å®šã—ãŸãƒ‘ã‚¹åã‚’ä½¿ã£ã¦ã€Parameter Store ã«æš—å·åŒ–ã—ã¦ä¿å­˜ã—ã¾ã™
- **é‡è¦**: ã“ã®ã‚¹ãƒ†ãƒƒãƒ—ã¯ `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ãŸå¾Œã«å®Ÿè¡Œã—ã¦ãã ã•ã„

**å‰ææ¡ä»¶:**
- [å‰ææ¡ä»¶ â†’ 5. èªè¨¼æƒ…å ±ã®æº–å‚™](#5-èªè¨¼æƒ…å ±ã®æº–å‚™) ã§ä»¥ä¸‹ã‚’æº–å‚™æ¸ˆã¿ã§ã‚ã‚‹ã“ã¨ï¼š
  - `credentials/service-account-key.json` ï¼ˆGoogle ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆèªè¨¼æƒ…å ±ï¼‰
  - Slack Bot Token ï¼ˆ`xoxb-` ã§å§‹ã¾ã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ï¼‰
  - Spreadsheet ID

#### 4-1. Parameter Store ã¸ã®ä¿å­˜ã‚³ãƒãƒ³ãƒ‰

**`.env` ãƒ•ã‚¡ã‚¤ãƒ«ã§è¨­å®šã—ãŸç’°å¢ƒå¤‰æ•°ã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™:**

**nushell ã®å ´åˆ:**
```bash
# Google ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆèªè¨¼æƒ…å ±ã‚’ä¿å­˜
(aws ssm put-parameter
  --name $env.TF_VAR_param_google_credentials
  --value (cat credentials/service-account-key.json)
  --type "SecureString"
  --overwrite)

# Slack Bot Token ã‚’ä¿å­˜
(aws ssm put-parameter
  --name $env.TF_VAR_param_slack_bot_token
  --value "xoxb-your-slack-bot-token-here"
  --type "SecureString"
  --overwrite)

# Spreadsheet ID ã‚’ä¿å­˜
(aws ssm put-parameter
  --name $env.TF_VAR_param_spreadsheet_id
  --value "your-spreadsheet-id-here"
  --type "SecureString"
  --overwrite)
```

**bash ã®å ´åˆ:**

```bash
# Google ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆèªè¨¼æƒ…å ±ã‚’ä¿å­˜
aws ssm put-parameter \
  --name "$TF_VAR_param_google_credentials" \
  --value "$(cat credentials/service-account-key.json)" \
  --type "SecureString" \
  --overwrite

# Slack Bot Token ã‚’ä¿å­˜
aws ssm put-parameter \
  --name "$TF_VAR_param_slack_bot_token" \
  --value "xoxb-your-slack-bot-token-here" \
  --type "SecureString" \
  --overwrite

# Spreadsheet ID ã‚’ä¿å­˜
aws ssm put-parameter \
  --name "$TF_VAR_param_spreadsheet_id" \
  --value "your-spreadsheet-id-here" \
  --type "SecureString" \
  --overwrite
```

#### 4-2. ä¿å­˜ã®ç¢ºèª

```bash
# ä¿å­˜ã•ã‚ŒãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ä¸€è¦§ã‚’ç¢ºèª
aws ssm describe-parameters --filters "Key=Name,Values=/your-prefix/"

# ç‰¹å®šã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å€¤ã‚’ç¢ºèªï¼ˆå¾©å·åŒ–ã—ã¦è¡¨ç¤ºï¼‰
aws ssm get-parameter --name "/your-prefix/spreadsheet-id" --with-decryption --query "Parameter.Value" --output text
```

> **ğŸ’¡ Parameter Store ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**
> - `SecureString` ã‚¿ã‚¤ãƒ—ã§æš—å·åŒ–ä¿å­˜ï¼ˆAWS KMS ã‚’ä½¿ç”¨ï¼‰
> - IAM ãƒ­ãƒ¼ãƒ«ã«ã‚ˆã‚‹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
> - å€¤ã®å¤‰æ›´å±¥æ­´ã‚’ä¿æŒ
> - `--overwrite` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§æ—¢å­˜å€¤ã‚’æ›´æ–°å¯èƒ½

> **âš ï¸ æ³¨æ„äº‹é …**
> - `credentials/service-account-key.json` ã¯ `.gitignore` ã«è¿½åŠ ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€Git ã«ã‚³ãƒŸãƒƒãƒˆã•ã‚Œã¾ã›ã‚“
> - Slack Bot Token ã¯çµ¶å¯¾ã« Git ã«ã‚³ãƒŸãƒƒãƒˆã—ãªã„ã§ãã ã•ã„
> - Parameter Store ã®ãƒ‘ã‚¹åï¼ˆãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ï¼‰ã¯æ¨æ¸¬ã•ã‚Œã«ãã„ã‚‚ã®ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„

### 5. Terraform Backend ã®è¨­å®š

#### 5-1. backend.tf ã®ã‚³ãƒ”ãƒ¼

```bash
cd terraform
cp backend.tf.example backend.tf
```

**ãªãœã“ã®ã‚¹ãƒ†ãƒƒãƒ—ãŒå¿…è¦ï¼Ÿ**
- `backend.tf.example` ã¯**ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ**ï¼ˆGit ã«ã‚³ãƒŸãƒƒãƒˆï¼‰
- å®Ÿéš›ã® `backend.tf` ã«ã¯**S3ãƒã‚±ãƒƒãƒˆå**ã‚’å«ã‚€ãŸã‚ `.gitignore` ã§é™¤å¤–
- ã“ã‚Œã«ã‚ˆã‚Šã€ãƒã‚±ãƒƒãƒˆåã‚’èª¤ã£ã¦å…¬é–‹ã™ã‚‹ãƒªã‚¹ã‚¯ã‚’å›é¿

> **ğŸ’¡ terraform.tfvars ã¯ä¸è¦**
> - ã™ã¹ã¦ã®å¤‰æ•°ã¯ `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã§ `TF_VAR_*` ã¨ã—ã¦ç®¡ç†
> - `terraform.tfvars` ãƒ•ã‚¡ã‚¤ãƒ«ã¯ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã›ã‚“

#### 5-2. backend.tf ã®ç·¨é›†

```bash
vim backend.tf
```

ä»¥ä¸‹ã® `YOUR_BUCKET_NAME` ã‚’**å®Ÿéš›ã® S3 ãƒã‚±ãƒƒãƒˆå**ã«ç½®ãæ›ãˆã¾ã™ï¼š

```hcl
terraform {
  backend "s3" {
    bucket         = "my-terraform-state-bucket-12345"  # â† ã‚ãªãŸã®ãƒã‚±ãƒƒãƒˆå
    key            = "helloStrandsAgentWithGoogleSpreadsheetsAndSlack/terraform.tfstate"
    region         = "ap-northeast-1"
    use_lockfile   = true
  }
}
```

**ãªãœ S3 ãƒã‚±ãƒƒãƒˆãŒå¿…è¦ï¼Ÿ**
- Terraform ã®**çŠ¶æ…‹ãƒ•ã‚¡ã‚¤ãƒ«**ã‚’ä¿å­˜ã™ã‚‹å ´æ‰€
- ãƒãƒ¼ãƒ ã§å…±æœ‰ã—ãŸã‚Šã€çŠ¶æ…‹ã‚’æ°¸ç¶šåŒ–ã™ã‚‹ãŸã‚
- **é‡è¦**: ãƒã‚±ãƒƒãƒˆåã¯å…¨ä¸–ç•Œã§ãƒ¦ãƒ‹ãƒ¼ã‚¯ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™

**ãƒã‚±ãƒƒãƒˆã®ä½œæˆæ–¹æ³•:**

```bash
aws s3 mb s3://my-terraform-state-bucket-12345 --region ap-northeast-1
```

### 6. Terraform ã®å®Ÿè¡Œ

#### 6-1. åˆæœŸåŒ–

```bash
terraform init
```

**ãªãœ init ãŒå¿…è¦ï¼Ÿ**
- Terraform ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ï¼ˆAWS Provider ãªã©ï¼‰ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
- Backendï¼ˆS3ï¼‰ã®åˆæœŸåŒ–
- ä¾å­˜é–¢ä¿‚ã®è§£æ±º

**ã“ã®ã‚¹ãƒ†ãƒƒãƒ—ã§è¡Œã‚ã‚Œã‚‹ã“ã¨:**
- `.terraform/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒä½œæˆã•ã‚Œã‚‹
- S3 ãƒã‚±ãƒƒãƒˆã«æ¥ç¶šã—ã¦çŠ¶æ…‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèª

#### 6-2. ãƒ—ãƒ©ãƒ³ã®ç¢ºèª

```bash
terraform plan
```

**ãªãœ plan ã‚’å®Ÿè¡Œã™ã‚‹ã®ã‹ï¼Ÿ**
- **å®Ÿéš›ã«ä½œæˆã•ã‚Œã‚‹å‰ã«**ã€ä½•ãŒä½œã‚‰ã‚Œã‚‹ã‹ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ãã‚‹
- ã‚³ã‚¹ãƒˆã‚„ãƒªã‚½ãƒ¼ã‚¹ã®ç¢ºèª
- ã‚¨ãƒ©ãƒ¼ã®äº‹å‰æ¤œå‡º

**ç¢ºèªã™ã¹ããƒã‚¤ãƒ³ãƒˆ:**
- ä½œæˆã•ã‚Œã‚‹ãƒªã‚½ãƒ¼ã‚¹æ•°ï¼ˆ`Plan: X to add, 0 to change, 0 to destroy`ï¼‰
- Lambda é–¢æ•°ã€API Gatewayã€ECR ãƒªãƒã‚¸ãƒˆãƒªãªã©ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹

#### 6-3. ã‚¤ãƒ³ãƒ•ãƒ©ã®æ§‹ç¯‰

```bash
terraform apply
```

**ãªãœ apply ãŒå¿…è¦ï¼Ÿ**
- å®Ÿéš›ã« AWS ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆ
- Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã—ã¦ ECR ã«ãƒ—ãƒƒã‚·ãƒ¥
- Lambda é–¢æ•°ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤

**ã“ã®ã‚¹ãƒ†ãƒƒãƒ—ã§è¡Œã‚ã‚Œã‚‹ã“ã¨:**
1. Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰ï¼ˆæ•°åˆ†ã‹ã‹ã‚Šã¾ã™ï¼‰
2. ECR ã¸ã®ãƒ—ãƒƒã‚·ãƒ¥
3. Lambda é–¢æ•°ã®ä½œæˆ
4. API Gateway ã®ä½œæˆ
5. IAM ãƒ­ãƒ¼ãƒ«ã®ä½œæˆ

**å®Ÿè¡Œæ™‚é–“:** åˆå›ã¯ **5ã€œ10åˆ†** ç¨‹åº¦ã‹ã‹ã‚Šã¾ã™

**ç¢ºèªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:**
```
Do you want to perform these actions?
  Terraform will perform the actions described above.
  Only 'yes' will be accepted to approve.

  Enter a value: yes  # â† "yes" ã¨å…¥åŠ›
```

### 7. ãƒ‡ãƒ—ãƒ­ã‚¤ã®ç¢ºèª

#### 7-1. API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å–å¾—

```bash
terraform output api_endpoint
```

**å‡ºåŠ›ä¾‹:**
```
https://xxxxx.execute-api.ap-northeast-1.amazonaws.com
```

#### 7-2. å‹•ä½œç¢ºèª

```bash
curl -X POST https://xxxxx.execute-api.ap-northeast-1.amazonaws.com/invoke \
  -H "Content-Type: application/json" \
  -d '{"prompt": "ã“ã‚“ã«ã¡ã¯ï¼"}'
```

**æœŸå¾…ã•ã‚Œã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "message": "ã“ã‚“ã«ã¡ã¯ï¼ä½•ã‹ãŠæ‰‹ä¼ã„ã§ãã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ"
}
```

**ãªãœã“ã®ãƒ†ã‚¹ãƒˆãŒé‡è¦ï¼Ÿ**
- API Gateway â†’ Lambda â†’ Bedrock ã®å…¨çµŒè·¯ãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
- å•é¡ŒãŒã‚ã‚Œã°ã€ã©ã“ã§å¤±æ•—ã—ã¦ã„ã‚‹ã‹åˆ‡ã‚Šåˆ†ã‘ã‚‰ã‚Œã‚‹

#### 7-3. ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä½¿ç”¨

**ãªãœãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ã†ã®ã‹ï¼Ÿ**
- `terraform output` ã‚’è‡ªå‹•çš„ã«å–å¾—ã™ã‚‹ãŸã‚ã€ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ URL ã‚’ã‚³ãƒ”ãƒ¼ï¼†ãƒšãƒ¼ã‚¹ãƒˆã™ã‚‹æ‰‹é–“ãŒä¸è¦
- æ¯å›åŒã˜ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã™ã‚‹å¿…è¦ãŒãªãã€åŠ¹ç‡çš„ã«ãƒ†ã‚¹ãƒˆã§ãã‚‹
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ã‚„ HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã‚‚è‡ªå‹•è¡¨ç¤º

**åŸºæœ¬çš„ãªä½¿ã„æ–¹:**

```bash
# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§ãƒ†ã‚¹ãƒˆ
./test_api.sh
```

**ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§ãƒ†ã‚¹ãƒˆ:**

```bash
# Slack ã¸ã®é€šçŸ¥ã‚’ãƒ†ã‚¹ãƒˆ
./test_api.sh "Slackã«ã€Œãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†ã€ã¨ã„ã†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã¦ãã ã•ã„"

# Google Spreadsheet ã¸ã®è¿½åŠ ã‚’ãƒ†ã‚¹ãƒˆ
./test_api.sh "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã€Œæ–°æ©Ÿèƒ½é–‹ç™ºã€ã‚’ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«è¿½åŠ ã—ã¦ãã ã•ã„"

# è¤‡æ•°ãƒ„ãƒ¼ãƒ«ã®é€£æºã‚’ãƒ†ã‚¹ãƒˆ
./test_api.sh "æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã€ŒAPIæ”¹å–„ã€ã‚’ã‚·ãƒ¼ãƒˆã«è¿½åŠ ã—ã¦ã€Slackã«é€šçŸ¥ã—ã¦ãã ã•ã„"
```

**å‡ºåŠ›ä¾‹:**

```bash
ğŸ” Terraform output ã‹ã‚‰ API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å–å¾—ä¸­...
âœ… API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ: https://xxxxx.execute-api.ap-northeast-1.amazonaws.com/invoke

ğŸ“¤ ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡ä¸­...
ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ: Slackã«ã€Œãƒ†ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€ã‚’é€ä¿¡ã—ã¦ãã ã•ã„

{"message":"Slackã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã¾ã—ãŸï¼"}

â±ï¸  HTTP Status: 200
â±ï¸  Total time: 2.451s

âœ… ãƒ†ã‚¹ãƒˆå®Œäº†
```

**ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ç‰¹å¾´:**
- âœ… ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè‡ªå‹•å–å¾—: `terraform output` ã‹ã‚‰è‡ªå‹•çš„ã«å–å¾—
- âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°: terraform ãŒæœªå®Ÿè¡Œã®å ´åˆã¯ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
- âœ… ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®š: ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ã‚’è‡ªå‹•è¨ˆæ¸¬
- âœ… ä½¿ã„ã‚„ã™ã•: å¼•æ•°ã‚’çœç•¥ã™ã‚Œã°ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§å®Ÿè¡Œ

---

## ğŸ› ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚¨ãƒ©ãƒ¼: `Error: Backend initialization failed`

**åŸå› :**
- S3 ãƒã‚±ãƒƒãƒˆãŒå­˜åœ¨ã—ãªã„
- ãƒã‚±ãƒƒãƒˆåãŒé–“é•ã£ã¦ã„ã‚‹
- AWS èªè¨¼æƒ…å ±ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„

**è§£æ±ºæ–¹æ³•:**

```bash
# S3 ãƒã‚±ãƒƒãƒˆã‚’ä½œæˆ
aws s3 mb s3://your-bucket-name --region ap-northeast-1

# AWS èªè¨¼æƒ…å ±ã‚’ç¢ºèª
aws sts get-caller-identity
```

### ã‚¨ãƒ©ãƒ¼: `Error: creating ECR Repository: AccessDeniedException`

**åŸå› :**
- AWS IAM ãƒ¦ãƒ¼ã‚¶ãƒ¼ã« ECR ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒãªã„

**è§£æ±ºæ–¹æ³•:**
- IAM ãƒ¦ãƒ¼ã‚¶ãƒ¼ã« `AmazonEC2ContainerRegistryFullAccess` ãƒãƒªã‚·ãƒ¼ã‚’ã‚¢ã‚¿ãƒƒãƒ

### ã‚¨ãƒ©ãƒ¼: `Error: error invoking Lambda function: ... Bedrock model access`

**åŸå› :**
- Bedrock ãƒ¢ãƒ‡ãƒ«ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒè¨±å¯ã•ã‚Œã¦ã„ãªã„

**è§£æ±ºæ–¹æ³•:**
1. AWS Console â†’ Bedrock â†’ Model access
2. `jp.anthropic.claude-sonnet-4-5-20250929-v1:0` ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
3. æ‰¿èªã•ã‚Œã‚‹ã¾ã§å¾…æ©Ÿï¼ˆé€šå¸¸ã¯å³åº§ã«æ‰¿èªï¼‰

### Docker ãƒ“ãƒ«ãƒ‰ãŒé…ã„

**åŸå› :**
- åˆå›ãƒ“ãƒ«ãƒ‰ã§ã¯ Python ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã™ã¹ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãŸã‚æ™‚é–“ãŒã‹ã‹ã‚‹

**è§£æ±ºæ–¹æ³•:**
- 2å›ç›®ä»¥é™ã¯ Docker ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒåŠ¹ããŸã‚é«˜é€ŸåŒ–ã•ã‚Œã¾ã™
- è¾›æŠ±å¼·ãå¾…ã¡ã¾ã—ã‚‡ã† ğŸ™‚

### API ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒ 500 ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™

**ãƒ‡ãƒãƒƒã‚°æ–¹æ³•:**

```bash
# Lambda ã®ãƒ­ã‚°ã‚’ç¢ºèª
aws logs tail /aws/lambda/hello-agent --follow
```

**ã‚ˆãã‚ã‚‹åŸå› :**
- ç’°å¢ƒå¤‰æ•°ã®è¨­å®šãƒŸã‚¹
- Bedrock ãƒ¢ãƒ‡ãƒ« ID ã®é–“é•ã„
- Google Sheets / Slack ã®èªè¨¼æƒ…å ±ãŒæœªè¨­å®š

---

## ğŸ“š æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### 1. Google Sheets ã¨ã®é€£æºã‚’è¨­å®š

`terraform/lambda_code/src/services/google_sheets.py` ã« Google Sheets API ã®èªè¨¼æƒ…å ±ã‚’è¨­å®šã—ã¾ã™ã€‚

### 2. Slack ã¨ã®é€£æºã‚’è¨­å®š

`terraform/lambda_code/src/services/slack_service.py` ã« Slack ã® Webhook URL ã‚’è¨­å®šã—ã¾ã™ã€‚

### 3. ã‚«ã‚¹ã‚¿ãƒ ãƒ„ãƒ¼ãƒ«ã‚’è¿½åŠ 

`terraform/lambda_code/src/tools/` ã«æ–°ã—ã„ãƒ„ãƒ¼ãƒ«ã‚’è¿½åŠ ã—ã¦ã€AI ã®èƒ½åŠ›ã‚’æ‹¡å¼µã§ãã¾ã™ã€‚

**ä¾‹: å¤©æ°—æƒ…å ±ãƒ„ãƒ¼ãƒ«**

```python
from strands import tool

@tool
def get_weather(city: str) -> str:
    """æŒ‡å®šã•ã‚ŒãŸéƒ½å¸‚ã®å¤©æ°—ã‚’å–å¾—ã—ã¾ã™"""
    # å¤©æ°— API ã‚’å‘¼ã³å‡ºã™å‡¦ç†
    return f"{city} ã®å¤©æ°—ã¯æ™´ã‚Œã§ã™"
```

### 4. æœ¬ç•ªé‹ç”¨ã¸ã®ç§»è¡Œ

- **èªè¨¼ã®è¿½åŠ **: API Gateway ã« API ã‚­ãƒ¼ã‚„ Cognito èªè¨¼ã‚’è¿½åŠ 
- **ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°**: CloudWatch ã‚¢ãƒ©ãƒ¼ãƒ ã®è¨­å®š
- **ã‚³ã‚¹ãƒˆæœ€é©åŒ–**: Lambda ã®ãƒ¡ãƒ¢ãƒªãƒ»ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆèª¿æ•´

---

## ğŸ§¹ ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

ãƒªã‚½ãƒ¼ã‚¹ã‚’å‰Šé™¤ã—ã¦ã‚³ã‚¹ãƒˆã‚’ç¯€ç´„ï¼š

```bash
cd terraform
terraform destroy
```

**ãªãœ destroy ãŒé‡è¦ï¼Ÿ**
- ä½¿ç”¨ã—ã¦ã„ãªã„ AWS ãƒªã‚½ãƒ¼ã‚¹ã¯èª²é‡‘ãŒç¶šã
- ç‰¹ã« ECR ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚„ Lambda é–¢æ•°ã¯å‰Šé™¤ã—ãªã„ã¨ã‚³ã‚¹ãƒˆãŒç™ºç”Ÿ

---

## ğŸ“– å­¦ç¿’ãƒªã‚½ãƒ¼ã‚¹

### Strands ã«ã¤ã„ã¦
- [Strands å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://github.com/strands-ai/strands)

### AWS Bedrock ã«ã¤ã„ã¦
- [AWS Bedrock å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.aws.amazon.com/bedrock/)
- [Claude on Bedrock](https://docs.anthropic.com/claude/docs/amazon-bedrock)

### Terraform ã«ã¤ã„ã¦
- [Terraform å…¬å¼ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«](https://learn.hashicorp.com/terraform)
- [Terraform AWS Provider](https://registry.terraform.io/providers/hashicorp/aws/latest/docs)

### AI ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ã¤ã„ã¦
- [LangChain ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://python.langchain.com/docs/get_started/introduction)
- [OpenAI Function Calling](https://platform.openai.com/docs/guides/function-calling)

---

## ğŸ¤ ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³

Issue ã‚„ Pull Request ã‚’ãŠå¾…ã¡ã—ã¦ã„ã¾ã™ï¼

## ğŸ“„ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License
